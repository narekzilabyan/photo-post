{% extends 'base.html.twig' %}

{% block javascripts %}
    <script type="text/javascript">
        function showReplyBox(id) {
            document.getElementById('reply'+id).style.display = "block";
            document.getElementById(id+'reply').style.display = "none";
        }
    </script>
{% endblock %}

{% block body %}
    <h1>Post</h1>
    <div class="show">
        <h2>{{ post.title }}</h2>
        <p>{{ post.description }}</p>
        <p>{{ post.rating }}</p>
        <p>{{ post.date|date("Y-m-d") }}</p>
        <img src="/uploads/images/{{post.imageName}}" />
    </div>

    {% if is_granted("ROLE_USER") %}
        <div class="vote">
        {% if vote is not null %}
            <p>{{ vote.vote }}</p>
        {% else %}
            {% for i in 0..5 %}
                <a href="{{ path('post_vote', { 'postId': post.id, 'vote' : i }) }}">{{ i }}</a>
            {% endfor %}
        {% endif %}
        </div>

        <div class="add-comment">
            <form action="{{ path('post_comment', { 'postId': post.id }) }}" method="post" class="comment-form" enctype="multipart/form-data">
                <div class="comment-box">
                    <textarea  name="comment[content]" required="required"></textarea>
                </div>
                <button class="btn btn-lg btn-primary" type="submit">Add comment</button>
            </form>
        </div>

        <div class="comment">
            {% for comment in comments %}
                <p>{{ comment.content }}</p>
                {% if comment.children is defined %}
                    {% for reply in comment.children|reverse %}
                        <p>{{ reply.content }}</p>
                    {% endfor %}
                {% endif %}
                <p onclick="showReplyBox('{{ comment.id }}')" id="{{ comment.id }}reply">Reply</p>
                <div  style="display: none" id="reply{{ comment.id }}">
                <form action="{{ path('post_comment', { 'postId': post.id, 'parentId' : comment.id }) }}" method="post" class="comment-form" enctype="multipart/form-data">
                    <div class="comment-box">
                        <textarea  name="comment[content]" required="required"></textarea>
                    </div>
                    <button class="btn btn-lg btn-primary" type="submit">Add reply</button>
                </form>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}